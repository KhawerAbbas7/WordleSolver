<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wordle Helper</title>
  <style>
    body {
      background: #121213;
      color: #fff;
      font-family: 'Clear Sans', Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      margin: 0;
    }
    .wordle-row {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      gap: 10px;
      margin-bottom: 10px;
    }
    .wordle-row input {
      width: 60px;
      height: 60px;
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      background-color: #3a3a3c;
      border: none;
      color: #fff;
      text-transform: uppercase;
      cursor: pointer;
    }
    .wordle-row input.state-0 { background-color: #3a3a3c; }
    .wordle-row input.state-1 { background-color: #b59f3b; }
    .wordle-row input.state-2 { background-color: #538d4e; }
    .wordle-row input:focus { outline: 2px solid #565758; }

    #output {
      margin-top: 2rem;
      width: 100%;
      max-width: 100%;
      overflow-x: auto;
      padding: 10px;
      background: #222;
      border-radius: 8px;
    }
    table {
      border-collapse: collapse;
      min-width: 600px;
      white-space: nowrap;
    }
    thead th {
      background: #333;
      padding: 12px;
      font-weight: bold;
      border-bottom: 2px solid #555;
      text-align: center;
    }
    tbody td {
      padding: 10px;
      border-bottom: 1px solid #444;
      text-align: center;
    }
    .word-box {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #2a2a2a;
      padding: 5px 8px;
      border-radius: 6px;
      width: 120px;
      font-family: monospace;
      font-size: 1.1rem;
    }
    .word-box button {
      background: #444;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      padding: 2px 6px;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .word-box button:hover { background: #666; }
    .word-box button.copied { background: #4caf50 !important; }

    @media (max-width: 600px) {
      .wordle-row {
        grid-template-columns: repeat(5, 50px);
        gap: 6px;
      }
      .wordle-row input {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
      }
      .word-box {
        font-size: 1rem;
        width: auto;
        padding: 4px 6px;
      }
      table {
        min-width: unset;
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div id="grid"></div>
  <div id="output">Loading words...</div>

  <script>
    let debounceTimer
    let lastKnown = ""

    function createInputGrid(rows = 6) {
      const grid = document.getElementById('grid')
      for (let r = 0; r < rows; r++) {
        const row = document.createElement('div')
        row.className = 'wordle-row'
        for (let c = 0; c < 5; c++) {
          const input = document.createElement('input')
          input.setAttribute('maxlength', 1)
          input.dataset.state = '0'
          row.appendChild(input)
        }
        grid.appendChild(row)
      }
    }

    function debounceUpdate() {
      clearTimeout(debounceTimer)
      debounceTimer = setTimeout(updateSuggestions, 150)
    }

    function updateSuggestions() {
      const inputs = document.querySelectorAll('#grid input')
      const known = []

      inputs.forEach((input, idx) => {
        const val = input.value.toLowerCase()
        const pos = idx % 5
        const state = Number(input.dataset.state)
        if (val.match(/[a-z]/)) known.push({ char: val, pos, state })
      })

      const str = JSON.stringify(known)
      if (str === lastKnown) return
      lastKnown = str

      output.innerHTML = "<p style='text-align:center;'>Loading...</p>"

      fetch('/api/filter', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: str
      })
      .then(res => res.json())
      .then(data => renderTable(data.words || []))
    }

    function renderTable(words) {
      if (!words.length) {
        output.innerHTML = "<p style='text-align:center;'>No matching words found.</p>"
        return
      }

      const fragment = document.createDocumentFragment()
      const table = document.createElement('table')
      const thead = table.createTHead()
      const trHead = thead.insertRow()
      const th = document.createElement('th')
      th.colSpan = 6
      th.textContent = `Matching Words (${words.length})`
      trHead.appendChild(th)

      const tbody = table.createTBody()
      for (let i = 0; i < words.length; i += 6) {
        const tr = tbody.insertRow()
        for (let j = 0; j < 6; j++) {
          const td = tr.insertCell()
          const word = words[i + j]
          if (word) {
            const box = document.createElement('div')
            box.className = 'word-box'
            box.innerHTML = `<span>${word}</span><button onclick="copyWord(this, '${word}')">ðŸ“‹</button>`
            td.appendChild(box)
          }
        }
      }

      fragment.appendChild(table)
      output.innerHTML = ''
      output.appendChild(fragment)
    }

    window.copyWord = (btn, word) => {
      navigator.clipboard.writeText(word)
      btn.classList.add('copied')
      btn.innerText = 'âœ…'
      setTimeout(() => {
        btn.classList.remove('copied')
        btn.innerText = 'ðŸ“‹'
      }, 1000)
    }

    function bindInputs() {
      const inputs = document.querySelectorAll('#grid input')

      inputs.forEach((input, idx, arr) => {
        input.addEventListener('input', e => {
          const val = e.target.value.toUpperCase()
          if (val) e.target.value = val[0]
          debounceUpdate()
        })

        input.addEventListener('keyup', e => {
          if (e.key !== 'Backspace' && idx < arr.length - 1) arr[idx + 1].focus()
          if (e.key === 'Backspace' && !input.value && idx > 0) arr[idx - 1].focus()
        })

        input.addEventListener('click', () => {
          if (!input.value) return
          let state = Number(input.dataset.state)
          state = (state + 1) % 3
          input.dataset.state = state
          input.classList.remove('state-0', 'state-1', 'state-2')
          input.classList.add('state-' + state)
          debounceUpdate()
        })
      })

      if (inputs.length) inputs[0].focus()
    }

    window.onload = () => {
      createInputGrid()
      bindInputs()
      updateSuggestions()
    }
  </script>
</body>
</html>
